// schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL") // Set PostgreSQL database connection URL here
}

model User {
  user_id         Int            @id @default(autoincrement())
  user_name       String
  private_id      String         @unique
  public_id       String         @unique
  profile_picture String?
  last_seen       DateTime?
  sent_messages   Message[]      @relation("sender")
  conversations1  Conversation[] @relation("user1")
  conversations2  Conversation[] @relation("user2")
}

model Conversation {
  conversation_id Int       @id @default(autoincrement())
  user1_id        Int
  user2_id        Int
  last_message_at DateTime?

  user1 User @relation("user1", fields: [user1_id], references: [user_id])
  user2 User @relation("user2", fields: [user2_id], references: [user_id])

  messages Message[]
}

model Message {
  message_id      Int      @id @default(autoincrement())
  conversation_id Int
  sender_id       Int
  content         String
  timestamp       DateTime
  is_read         Boolean  @default(false)

  conversation Conversation @relation(fields: [conversation_id], references: [conversation_id])
  sender       User         @relation("sender", fields: [sender_id], references: [user_id])
}

generator client {
  provider = "prisma-client-js"
}
